<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>ลงทะเบียน</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />

    <!-- Bootstrap & BootstrapVue CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-vue/2.23.1/bootstrap-vue.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-vue/2.23.1/bootstrap-vue-icons.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/vue-select@3.20.2/dist/vue-select.css"
    />

    <style>
      html,
      body {
        /* scrollbar-gutter: stable; */
        background: #f8f9fa;
      }
      #vs1__combobox {
        border-radius: 5px !important;
        height: calc(1.5em + 0.75rem + 2px);
      }
      .v-select {
        width: 100%;
      }
      .v-select .dropdown-toggle {
        height: calc(2.25rem + 2px);
      }
      legend {
        font-weight: 500 !important;
        font-size: 1.2rem !important;
        color: #311B92 !important;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- Landing page before registration -->
      <template v-if="!register">
        <b-container
          fluid
          class="d-flex flex-column justify-content-center align-items-center min-vh-100"
        >
          <!-- Wrapper to center all contents and restrict max width -->
          <div class="text-center w-100 mx-auto" style="max-width: 420px">
            <h1 style="font-weight: 500!important; color: #311B92;">{{ title }}</h1>
            <h4 class="mb-4" style="color: #E65100;">{{ subtitle }}</h4>

            <!-- Responsive image with shadow -->
            <b-row>
              <b-col cols="12" class="mb-2">
                <!-- Responsive image with shadow -->
                <b-img
                  src="pic-1.jpg"
                  fluid
                  alt="BENJI MORF"
                  class="custom-shadow"
                />
              </b-col>
              <b-col class="">
                <!-- Register button (responsive & max 400px) -->
                <b-button
                  variant="primary"
                  class="custom-shadow w-100"
                  @click="register = true"
                  style="max-width: 400px; height: 40px; border-radius: 10px; font-weight: 500!important; font-size: 1.2rem!important;"
                >
                  <i class="fas fa-heart"></i> สนใจเข้าร่วม
                </b-button>
              </b-col>
            </b-row>
          </div>
        </b-container>
      </template>

      <!-- Registration form -->
      <template v-else>
        <b-container
          fluid
          class="d-flex justify-content-center align-items-center min-vh-100"
        >
          <b-row class="register-input w-100" style="max-width: 420px">
            <!-- Title and back action -->
            <b-col
              cols="12"
              class="text-center mb-0"
              @click="register = false"
              style="cursor: pointer"
            >
              <h1 style="font-weight: 500!important; color: #311B92; position: relative; bottom: -5px;">
                {{ registerTitle }}
              </h1>
              <span class="text-muted">รายละเอียด</span>
            </b-col>

            <!-- Form fields -->
            <b-col cols="12" class="text-center mb-4" style="padding: 0px">
              <div class="register-form">
                <!-- Phone number -->
                <b-form-group label="เบอร์โทรศัพท์" label-class="text-left">
                  <b-form-input
                    v-model="form.number_id"
                    type="text"
                    maxlength="10"
                    @input="form.number_id = form.number_id.replace(/\D/g, '').slice(0, 10)"
                    placeholder="เบอร์โทรศัพท์ (เช่น 0812345678)"
                    autofocus
                    required
                  ></b-form-input>
                </b-form-group>

                <!-- Province select -->
                <b-form-group label="จังหวัด" label-class="text-left">
                  <v-select
                    v-model="form.province"
                    :options="provinceOptions"
                    placeholder="เลือกจังหวัด"
                  ></v-select>
                </b-form-group>

                <!-- First name -->
                <b-form-group label="ชื่อ" label-class="text-left">
                  <b-form-input
                    v-model="form.first_name"
                    type="text"
                    placeholder="ชื่อ"
                    required
                  ></b-form-input>
                </b-form-group>

                <!-- Last name -->
                <b-form-group label="นามสกุล" label-class="text-left">
                  <b-form-input
                    v-model="form.last_name"
                    type="text"
                    placeholder="นามสกุล"
                    required
                  ></b-form-input>
                </b-form-group>

                <!-- Class (read-only) -->
                <b-form-group
                  class="mb-2"
                  label="เข้าร่วมการอบรม"
                  label-class="text-left"
                >
                  <b-form-input
                    v-model="form.class"
                    type="text"
                    class="bg-white"
                    placeholder="ชั้นเรียน"
                    required
                    readonly
                  ></b-form-input>
                </b-form-group>

                <!-- Submit button -->
                <b-button
                  class="custom-shadow text-center w-100"
                  style="max-width: 400px; height: 40px; border-radius: 10px; font-weight: 500!important; font-size: 1.2rem!important;"
                  variant="primary"
                  @click="btnSubmit"
                >
                  <i class="fas fa-paper-plane"></i> ลงทะเบียน
                </b-button>
              </div>
            </b-col>
          </b-row>
        </b-container>
      </template>
    </div>
  </body>

  <!-- JS Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-vue/2.23.1/bootstrap-vue.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.6/axios.min.js"></script>
  <script src="https://unpkg.com/vue-select@3.20.2/dist/vue-select.js"></script>

  <script>
    Vue.component("v-select", VueSelect.VueSelect);

    const app = new Vue({
      el: "#app",
      data() {
        return {
          // Page titles
          title: "เข้าร่วมการอบรม",
          subtitle: "โดย BENJI MORF",
          registerTitle: "ลงทะเบียน",

          // State variables
          register: false,
          showLineQR: false,

          // Registration form
          form: {
            number_id: null,
            first_name: null,
            last_name: null,
            class: "29 กันยายน 2025",
            province: null,
          },

          // Province options
          provinceOptions: [
            "กรุงเทพมหานคร",
            "กระบี่",
            "กาญจนบุรี",
            "กาฬสินธุ์",
            "กำแพงเพชร",
            "ขอนแก่น",
            "จันทบุรี",
            "ฉะเชิงเทรา",
            "ชลบุรี",
            "ชัยนาท",
            "ชัยภูมิ",
            "ชุมพร",
            "เชียงราย",
            "เชียงใหม่",
            "ตรัง",
            "ตราด",
            "ตาก",
            "นครนายก",
            "นครปฐม",
            "นครพนม",
            "นครราชสีมา",
            "นครศรีธรรมราช",
            "นครสวรรค์",
            "นนทบุรี",
            "นราธิวาส",
            "น่าน",
            "บึงกาฬ",
            "บุรีรัมย์",
            "ปทุมธานี",
            "ประจวบคีรีขันธ์",
            "ปราจีนบุรี",
            "ปัตตานี",
            "พระนครศรีอยุธยา",
            "พังงา",
            "พัทลุง",
            "พิจิตร",
            "พิษณุโลก",
            "เพชรบุรี",
            "เพชรบูรณ์",
            "แพร่",
            "พะเยา",
            "ภูเก็ต",
            "มหาสารคาม",
            "มุกดาหาร",
            "แม่ฮ่องสอน",
            "ยโสธร",
            "ยะลา",
            "ร้อยเอ็ด",
            "ระนอง",
            "ระยอง",
            "ราชบุรี",
            "ลพบุรี",
            "ลำปาง",
            "ลำพูน",
            "เลย",
            "ศรีสะเกษ",
            "สกลนคร",
            "สงขลา",
            "สตูล",
            "สมุทรปราการ",
            "สมุทรสงคราม",
            "สมุทรสาคร",
            "สระแก้ว",
            "สระบุรี",
            "สิงห์บุรี",
            "สุโขทัย",
            "สุพรรณบุรี",
            "สุราษฎร์ธานี",
            "สุรินทร์",
            "หนองคาย",
            "หนองบัวลำภู",
            "อ่างทอง",
            "อุดรธานี",
            "อุตรดิตถ์",
            "อุทัยธานี",
            "อุบลราชธานี",
            "อำนาจเจริญ",
          ],
        };
      },
      methods: {
        // Handle form submission
        async btnSubmit() {
          if (
            !this.form.number_id ||
            !this.form.first_name ||
            !this.form.last_name ||
            !this.form.class ||
            !this.form.province
          ) {
            alert("กรุณากรอกข้อมูลให้ครบถ้วน");
            return;
          }

          try {
            const response = await axios.post(
              "https://my-vercel-api-neon.vercel.app/api/register/add",
              this.form
            );

            console.log("Response:", response.data);

            // Show success / update / error message
            if (response.data.message === "Success") {
              this.$bvToast.toast("ระบบได้รับข้อมูลของท่านเรียบร้อยแล้ว", {
                title: "ลงทะเบียนสำเร็จ",
                variant: "primary",
                toaster: "b-toaster-top-center",
                solid: true,
              });

              this.showLineQR = true;
            } else if (response.data.message === "Update") {
              this.$bvToast.toast(
                "เบอร์โทรของท่านได้ลงทะเบียนไปแล้ว ข้อมูลใหม่จะถูกปรับปรุง",
                {
                  title: "แจ้งเตือน",
                  variant: "warning",
                  toaster: "b-toaster-top-center",
                  solid: true,
                }
              );

              this.showLineQR = true;
            } else {
              alert("เกิดข้อผิดพลาด");
            }

            // Reset form and go back to landing page
            this.register = false;
            this.form = {
              number_id: null,
              first_name: null,
              last_name: null,
              province: null,
            };
          } catch (error) {
            console.error("API Error:", error);
            alert("เกิดข้อผิดพลาดในการส่งข้อมูล");
          }
        },
      },
      created() {
        // Set document title dynamically
        document.title = this.title;
      },
    });
  </script>
</html>
